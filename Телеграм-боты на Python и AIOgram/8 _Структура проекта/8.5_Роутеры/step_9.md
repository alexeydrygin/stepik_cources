## Попытка запустить модульного эхо-бота
-------------------------------------

Думаю, если вы хорошо освоили урок про модули и пакеты, вы уже понимаете к чему приведет попытка запустить бота в том виде, что у нас получился. Да и IDE нам сигнализировала о проблемах

![](https://ucarecdn.com/e2d8391a-aff4-4b1d-a78c-1704828bf304/-/preview/-/enhance/78/)

Нет такого имени `dp` в пространстве имен. Но при этом если запустить **bot.py** - никаких ошибок в терминале не будет. Бот работает, но на команды не реагирует. Почему так становится понятно, если посмотреть на импорты в точке входа. Там просто нет никаких импортов ни из пакета с хэндлерами, ни из пакета **lexicon**. То есть точка входа и остальные пакеты проекта никак не связаны. Они живут отдельно друг от друга. Модули **other\_handlers.py** и **user\_handlers.py** не знают ни о каком диспетчере, а **bot.py** не знает ни о каких хэндлерах.

Что может прийти в голову в таком случае и чаще всего приходит начинающим разработчикам ботов? А давайте импортируем диспетчер из точки входа? Отвечаю сразу - не получится, потому что диспетчер мы инициализировали внутри асинхронной функции `main` и за пределами этой функции он все равно недоступен.

Но не надо мне верить на слово, давайте проверим. Более того, давайте вынесем диспетчер из функции, а в функцию передадим его как аргумент, вдруг так получится. Ведь теперь он будет виден не только в пределах области видимости функции `main`.

### bot.py

    import asyncio
    
    from aiogram import Bot, Dispatcher
    from config_data.config import Config, load_config
    
    # Инициализируем диспетчер
    dp: Dispatcher = Dispatcher()
    
    
    # Функция конфигурирования и запуска бота
    async def main(dp: Dispatcher):
    
        # Загружаем конфиг в переменную config
        config: Config = load_config()
    
        # Инициализируем бот
        bot: Bot = Bot(token=config.tg_bot.token)
    
        # Пропускаем накопившиеся апдейты и запускаем polling
        await bot.delete_webhook(drop_pending_updates=True)
        await dp.start_polling(bot)
    
    
    if __name__ == '__main__':
        asyncio.run(main(dp))

Добавим в модуль **other\_handlers.py** попытку импорта из **bot.py**. А почему в **other\_handlers.py**, а не в **user\_handlers.py**? А просто потому что там кода меньше. Для демонстрации - это не важно.

### other\_handlers.py

    from aiogram.types import Message
    
    from bot import dp
    from lexicon.lexicon import LEXICON_RU
    
    
    # Этот хэндлер будет срабатывать на любые ваши сообщения,
    # кроме команд "/start" и "/help"
    @dp.message()
    async def send_echo(message: Message):
        try:
            await message.send_copy(chat_id=message.chat.id)
        except TypeError:
            await message.reply(text=LEXICON_RU['no_echo'])

И запустим **bot.py** на исполнение.

Хм... В терминале ошибок нет, но бот по-прежнему не реагирует ни на команды, ни на любые другие апдейты. Оно и понятно почему - **bot.py** опять никак не связан с **other\_handlers.py**. Ну, точнее связан, но в одностороннем порядке. В **other\_handlers.py** есть импорт из **bot.py**, а в **bot.py** импортов из **other\_handlers.py** нет, потому при запуске **bot.py** код из **other\_handlers.py** не выполняется. Что же делать? Наверное, надо что-то импортировать из **other\_handlers.py**, да? Звучит логично. Но что оттуда импортировать? Там только один хэндлер. Можно, конечно, его импортировать, а также и все остальные хэндлеры из всех остальных модулей с хэндлерами. Но мы ведь наооборот пытаемся уйти от кода в одном файле, зачем мы это все тащить обратно будем? Не то.

Следующая идея, которая часто приходит в голову - а давайте создадим отдельный модуль, где проинициализируем диспетчер и будем его оттуда импортировать везде, где он нужен. Можно попробовать.