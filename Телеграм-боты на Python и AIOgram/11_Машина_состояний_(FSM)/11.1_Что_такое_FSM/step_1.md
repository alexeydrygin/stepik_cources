## FSM или конечный автомат
------------------------

Я долго ходил придумывал как объяснить, что такое **FSM** (Finite State Machine). Потому что с одной стороны, это не сказать, что очень, уж, простая математическая концепция, а с другой, на практике, там все довольно несложно и можно объяснить буквально одной фразой: в процессе взаимодействия с пользователем у бота могут быть какие-то конкретные состояния, которые могут быть изменены какими-то событиями. В каждый конкретный момент состояние бота может быть только одно, но всего состояний может быть столько, сколько потребуется. Понимаю, что сейчас звучит не очень понятно, но в конце этого шага мы еще раз вернемся к этой фразе и наложим ее на подробное объяснение ниже.

В одном из предыдущих ботов, а именно, "Угадай число", мы уже использовали состояния. Помните, нам нужно было проверять в каком состоянии находится пользователь бота - "игра" или "не игра", чтобы по-разному реагировать на сообщения пользователя? В других же ботах у нас никаких состояний не было, была просто реакция на команды, текст определенного вида или нажатия на кнопки. То есть, боту было все равно в какой момент будут совершены действия, его реакция зависела только от этих действий, но не от состояний. Но что, если мы хотим, чтобы бот не просто реагировал на какие-то действия, когда бы мы их не совершали, а имел возможность иногда реагировать только на одни из них, а иногда - только на другие?

Например, с помощью бота вы проводите анкетирование пользователей. Спрашиваете про возраст, род занятий, наличие детей, образование и так далее. Наверное, на вопрос про возраст странно было бы получить ответ "высшее", а на просьбу прислать фото, думаю, не хотелось бы получить ответ 24. А то будет как в том анекдоте про Лёху :) Как организовать такого бота, чтобы нужные хэндлеры срабатывали не только в зависимости от типа сообщения боту, но и учитывали состояние, в котором в конкретный момент должен находиться бот? То есть хэндлер, проверяющий корректность введенного возраста, пусть срабатывает не в любой момент, когда числа появляются в чате, а только в то время, когда бот, действительно, ждет числа, согласно логике работы. Пусть во время ожидания фотографии от пользователя, бот не будет срабатывать на текст с числами, а мягко сообщает пользователю, что вообще-то ожидается фото, попробуйте еще раз.

Вводя в свой арсенал состояния - мы можем строить, действительно, сложных ботов с разветвленной логикой работы, со сложными диалогами, с разными цепочками действий для разных пользователей. И наличие уже готовой машины состояний или FSM, или конечного автомата в `aiogram` - сильно упрощает жизнь разработчикам, потому что Telegram Bot API напрямую работу с состояниями не подразумевает.

Что нужно понять из текста выше. Есть состояния и есть условия для перехода из одного состояния в другое. Наступили условия - перешли в другое состояние и ожидаем новых условий. Не наступили условия - остаемся в том же состоянии, что и были. Давайте разбираться на практике.